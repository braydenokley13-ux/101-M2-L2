<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA League Commissioner - Revenue Sharing Challenge V2</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Background -->
    <div class="basketball-court"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="basketball-icon">üèÄ</div>
                <h1>NBA League Commissioner</h1>
            </div>
            <div class="subtitle">Revenue Sharing Challenge - Balance Competing Interests!</div>
        </header>

        <!-- Level Selection Screen -->
        <div id="levelSelect" class="level-select">
            <h2>Choose Your Challenge</h2>
            <p class="instructions">You're the NBA Commissioner! Balance the interests of big markets, small markets, AND league parity. It's harder than it looks!</p>

            <!-- Progress Overview -->
            <div class="progress-overview" id="progressOverview">
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-label" id="progressLabel">0 / 5 Levels Complete</div>
            </div>

            <div class="levels-grid">
                <div class="level-card" data-level="1">
                    <div class="level-badge">Level 1</div>
                    <div class="difficulty-badge easy">Easy</div>
                    <h3>üèÄ Rookie League</h3>
                    <p>Learn the basics - balance three competing interests</p>
                    <div class="level-stats">
                        <div class="stat-row">
                            <span>Parity Target:</span>
                            <span>65%</span>
                        </div>
                        <div class="stat-row">
                            <span>Big Market Min:</span>
                            <span>50%</span>
                        </div>
                        <div class="stat-row">
                            <span>Small Market Min:</span>
                            <span>60%</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="startLevel(1)">Play</button>
                    <div class="completion-badge" id="level1Complete">‚úÖ Completed</div>
                </div>

                <div class="level-card locked" data-level="2">
                    <div class="level-badge">Level 2</div>
                    <div class="difficulty-badge medium">Medium</div>
                    <h3>‚≠ê All-Star Challenge</h3>
                    <p>Big market owners are getting vocal about fairness</p>
                    <div class="level-stats">
                        <div class="stat-row">
                            <span>Parity Target:</span>
                            <span>68%</span>
                        </div>
                        <div class="stat-row">
                            <span>Big Market Min:</span>
                            <span>55%</span>
                        </div>
                        <div class="stat-row">
                            <span>Small Market Min:</span>
                            <span>65%</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="startLevel(2)">Play</button>
                    <div class="completion-badge" id="level2Complete">‚úÖ Completed</div>
                </div>

                <div class="level-card locked" data-level="3">
                    <div class="level-badge">Level 3</div>
                    <div class="difficulty-badge hard">Hard</div>
                    <h3>üèÜ Conference Finals</h3>
                    <p>Luxury tax adds another tool - use it wisely</p>
                    <div class="level-stats">
                        <div class="stat-row">
                            <span>Parity Target:</span>
                            <span>72%</span>
                        </div>
                        <div class="stat-row">
                            <span>Big Market Min:</span>
                            <span>52%</span>
                        </div>
                        <div class="stat-row">
                            <span>Small Market Min:</span>
                            <span>68%</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="startLevel(3)">Play</button>
                    <div class="completion-badge" id="level3Complete">‚úÖ Completed</div>
                </div>

                <div class="level-card locked" data-level="4">
                    <div class="level-badge">Level 4</div>
                    <div class="difficulty-badge very-hard">Very Hard</div>
                    <h3>üéñÔ∏è NBA Finals</h3>
                    <p>The sweet spot is narrow - precision matters</p>
                    <div class="level-stats">
                        <div class="stat-row">
                            <span>Parity Target:</span>
                            <span>75%</span>
                        </div>
                        <div class="stat-row">
                            <span>Big Market Min:</span>
                            <span>48%</span>
                        </div>
                        <div class="stat-row">
                            <span>Small Market Min:</span>
                            <span>72%</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="startLevel(4)">Play</button>
                    <div class="completion-badge" id="level4Complete">‚úÖ Completed</div>
                </div>

                <div class="level-card locked" data-level="5">
                    <div class="level-badge">Level 5</div>
                    <div class="difficulty-badge expert">Expert</div>
                    <h3>üëë Commissioner Legend</h3>
                    <p>Ultimate challenge - every team has an opinion</p>
                    <div class="level-stats">
                        <div class="stat-row">
                            <span>Parity Target:</span>
                            <span>78%</span>
                        </div>
                        <div class="stat-row">
                            <span>Big Market Min:</span>
                            <span>45%</span>
                        </div>
                        <div class="stat-row">
                            <span>Small Market Min:</span>
                            <span>75%</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="startLevel(5)">Play</button>
                    <div class="completion-badge" id="level5Complete">‚úÖ Completed</div>
                </div>
            </div>

            <!-- Sandbox Mode Button -->
            <div class="sandbox-section">
                <button class="sandbox-btn" onclick="startSandbox()">üß™ Sandbox Mode ‚Äî Free Explore (No Win Conditions)</button>
            </div>

            <!-- Key Concept Box -->
            <div class="concept-box">
                <h3>üí° The Commissioner's Dilemma</h3>
                <p><strong>Big markets say:</strong> "We earned this revenue! Why should we subsidize our competition?"</p>
                <p><strong>Small markets say:</strong> "We can't compete without help! How is that fair to our fans?"</p>
                <p><strong>Your job:</strong> Find the balance where BOTH sides can live with the deal. That's real commissioner work!</p>
            </div>

            <!-- Claim Codes Display -->
            <div class="claim-codes-section">
                <h3>üéØ Your Achievement Codes</h3>
                <div class="codes-grid">
                    <div class="code-card" id="code1">
                        <div class="code-label">Level 1 Complete</div>
                        <div class="code-value locked">üîí Complete Level 1</div>
                    </div>
                    <div class="code-card" id="code2">
                        <div class="code-label">Level 2 Complete</div>
                        <div class="code-value locked">üîí Complete Level 2</div>
                    </div>
                    <div class="code-card" id="code3">
                        <div class="code-label">Level 3 Complete</div>
                        <div class="code-value locked">üîí Complete Level 3</div>
                    </div>
                    <div class="code-card special" id="code3bonus">
                        <div class="code-label">‚≠ê 3 Levels Bonus</div>
                        <div class="code-value locked">üîí Complete 3 Levels</div>
                    </div>
                    <div class="code-card" id="code4">
                        <div class="code-label">Level 4 Complete</div>
                        <div class="code-value locked">üîí Complete Level 4</div>
                    </div>
                    <div class="code-card" id="code5">
                        <div class="code-label">Level 5 Complete</div>
                        <div class="code-value locked">üîí Complete Level 5</div>
                    </div>
                    <div class="code-card special master" id="code5bonus">
                        <div class="code-label">üèÜ MASTER COMMISSIONER</div>
                        <div class="code-value locked">üîí Complete All 5 Levels</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen hidden">
            <!-- Level Info Bar -->
            <div class="level-info-bar">
                <button class="back-btn" onclick="backToLevels()">‚Üê Back to Levels</button>
                <div class="current-level-display">
                    <span id="currentLevelName">Level 1: Rookie League</span>
                    <span class="difficulty-tag" id="levelDifficulty">Easy</span>
                    <span class="sandbox-tag hidden" id="sandboxTag">üß™ SANDBOX</span>
                </div>
                <!-- 3-Part Condition Tracker -->
                <div class="condition-tracker">
                    <div class="condition-pill" id="condParity">‚öñÔ∏è Parity</div>
                    <div class="condition-pill" id="condBig">üí∞ Big Mkt</div>
                    <div class="condition-pill" id="condSmall">üèüÔ∏è Small Mkt</div>
                </div>
            </div>

            <!-- Tutorial Overlay (Level 1 only) -->
            <div id="tutorialOverlay" class="tutorial-overlay hidden">
                <div class="tutorial-content">
                    <h3>Welcome, Commissioner! üëã</h3>
                    <p id="tutorialText"></p>
                    <button class="tutorial-btn" onclick="nextTutorialStep()">Next</button>
                </div>
            </div>

            <!-- Warning Messages -->
            <div id="warningMessages" class="warning-messages" style="display: none;"></div>

            <!-- Coach's Tips -->
            <div class="coach-corner">
                <div class="coach-icon">üßë‚Äçüè´</div>
                <div class="coach-message" id="coachMessage">
                    Balance revenue sharing to keep everyone happy - but that's easier said than done!
                </div>
            </div>

            <!-- Three Metrics Display -->
            <div class="metrics-dashboard">
                <!-- Parity Meter -->
                <div class="metric-card parity-card">
                    <div class="metric-header">
                        <span class="metric-title">‚öñÔ∏è League Parity</span>
                        <span class="metric-goal">Goal: <span id="goalParity">65</span>%+</span>
                    </div>
                    <div class="metric-bar-container">
                        <div class="metric-bar parity-bar" id="parityFill" style="width: 0%"></div>
                        <div class="threshold-marker" id="parityThreshold"></div>
                    </div>
                    <div class="metric-footer">
                        <span class="metric-score" id="parityScore">0%</span>
                        <span class="status-indicator status-fail" id="parityIndicator">‚úó</span>
                    </div>
                    <div class="metric-explain">Ratio of smallest to largest team revenue</div>
                </div>

                <!-- Big Market Satisfaction -->
                <div class="metric-card big-market-card">
                    <div class="metric-header">
                        <span class="metric-title">üí∞ Big Market Owners</span>
                        <span class="metric-goal">Min: <span id="goalBigMarket">50</span>%</span>
                    </div>
                    <div class="metric-bar-container">
                        <div class="metric-bar big-market-bar" id="bigMarketFill" style="width: 0%"></div>
                        <div class="threshold-marker" id="bigMarketThreshold"></div>
                    </div>
                    <div class="metric-footer">
                        <span class="metric-score" id="bigMarketScore">0%</span>
                        <span class="status-indicator status-fail" id="bigMarketIndicator">‚úó</span>
                    </div>
                    <div class="metric-explain">"We earned this - why subsidize others?"</div>
                </div>

                <!-- Small Market Viability -->
                <div class="metric-card small-market-card">
                    <div class="metric-header">
                        <span class="metric-title">üèüÔ∏è Small Market Survival</span>
                        <span class="metric-goal">Min: <span id="goalSmallMarket">60</span>%</span>
                    </div>
                    <div class="metric-bar-container">
                        <div class="metric-bar small-market-bar" id="smallMarketFill" style="width: 0%"></div>
                        <div class="threshold-marker" id="smallMarketThreshold"></div>
                    </div>
                    <div class="metric-footer">
                        <span class="metric-score" id="smallMarketScore">0%</span>
                        <span class="status-indicator status-fail" id="smallMarketIndicator">‚úó</span>
                    </div>
                    <div class="metric-explain">Can small markets field competitive teams?</div>
                </div>
            </div>

            <!-- Overall Status -->
            <div class="overall-status none" id="overallStatus">
                ‚öñÔ∏è Find the balance that works for everyone
            </div>

            <!-- Main Dashboard -->
            <div class="dashboard">
                <!-- Left Panel: Controls -->
                <div class="controls-panel">
                    <div class="control-group">
                        <label for="sharingSlider">
                            <span class="label-text">Revenue Sharing Percentage</span>
                            <span class="label-value" id="sharingValue">0%</span>
                        </label>
                        <input type="range" id="sharingSlider" class="slider" min="0" max="100" value="0" step="1">
                        <div class="slider-labels">
                            <span>0% (No sharing)</span>
                            <span>100% (Full pool)</span>
                        </div>
                    </div>

                    <div class="control-group" id="distributionControl">
                        <label class="label-text">Distribution Method</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-type="equal" onclick="setDistribution('equal')">
                                Equal Split
                            </button>
                            <button class="toggle-btn" data-type="weighted" onclick="setDistribution('weighted')">
                                Market Weighted
                            </button>
                        </div>
                        <div class="distribution-explainer">
                            <p id="distributionExplain">Equal: Every team gets the same share. Simple and fair, but might not help small markets enough.</p>
                        </div>
                    </div>

                    <div class="control-group" id="luxuryTaxControl" style="display: none;">
                        <label for="luxurySlider">
                            <span class="label-text">Luxury Tax Threshold ($M)</span>
                            <span class="label-value" id="luxuryValue">$150M</span>
                        </label>
                        <input type="range" id="luxurySlider" class="slider luxury-slider" min="100" max="300" value="150" step="10">
                        <div class="slider-labels">
                            <span>$100M (Strict)</span>
                            <span>$300M (Lenient)</span>
                        </div>
                        <div class="luxury-explainer">
                            Teams above this threshold pay 40% tax that goes to smaller teams
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="quick-stats">
                        <div class="stat-item">
                            <div class="stat-label">Total League Revenue</div>
                            <div class="stat-value" id="totalRevenue">$0M</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Revenue Gap</div>
                            <div class="stat-value" id="revenueGap">$0M</div>
                        </div>
                    </div>

                    <!-- Undo / Reset Controls -->
                    <div class="action-controls">
                        <button class="action-btn undo-btn" onclick="undoLastAction()" id="undoBtn" disabled>‚Ü© Undo</button>
                        <button class="action-btn reset-btn" onclick="resetLevel()">üîÑ Reset Level</button>
                    </div>

                    <!-- Hint System -->
                    <div class="hint-section">
                        <button class="hint-btn" onclick="showNextHint()" id="hintBtn">üí° Need a Hint?</button>
                        <div class="hint-box hidden" id="hintBox">
                            <div class="hint-tier" id="hintTierLabel">Hint 1 of 3</div>
                            <div class="hint-text" id="hintText"></div>
                        </div>
                    </div>

                    <!-- Show the Math Panel -->
                    <details class="math-panel" id="mathPanel" ontoggle="if(this.open && currentResults) renderMathPanel(currentResults)">
                        <summary>üìê Show How the Math Works</summary>
                        <div class="math-table-wrapper">
                            <table class="math-table" id="mathTable">
                                <thead>
                                    <tr>
                                        <th>Team</th>
                                        <th>Base</th>
                                        <th>-Shared</th>
                                        <th>+Received</th>
                                        <th>-Lux Tax</th>
                                        <th>+Lux Rcvd</th>
                                        <th>= Final</th>
                                    </tr>
                                </thead>
                                <tbody id="mathTableBody"></tbody>
                            </table>
                        </div>
                    </details>
                </div>

                <!-- Right Panel: Visualization -->
                <div class="visualization-panel">
                    <!-- Team Cards -->
                    <div class="teams-container">
                        <h3 class="section-title">NBA Teams - Watch Their Reactions!</h3>
                        <div class="teams-grid" id="teamsGrid"></div>
                    </div>

                    <!-- Chart -->
                    <div class="chart-container">
                        <h3 class="section-title">Revenue Comparison</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Success Modal -->
            <div id="successModal" class="modal hidden">
                <div class="modal-content">
                    <div id="confettiContainer"></div>
                    <h2>üéâ Level Complete!</h2>
                    <p class="success-message" id="successMessage"></p>
                    <div class="lesson-recap">
                        <p><strong>You learned:</strong> Revenue sharing is about finding the balance where big markets don't feel robbed and small markets can still compete. That's exactly what real commissioners do!</p>
                    </div>
                    <!-- Compare to Reality Panel -->
                    <div class="reality-compare" id="realityCompare">
                        <div class="reality-label">üèÄ Real NBA Facts</div>
                        <div class="reality-text" id="realityText"></div>
                    </div>
                    <div class="claim-code-reveal">
                        <div class="code-label">Your Claim Code:</div>
                        <div class="code-box" id="claimCodeBox">
                            <span id="claimCodeText"></span>
                            <button class="copy-btn" onclick="copyClaimCode()">Copy</button>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-primary" onclick="closeSuccessModal()">Play Next Level ‚Üí</button>
                        <button class="btn-secondary" onclick="retryLevel()">Play Again</button>
                    </div>
                </div>
            </div>

            <!-- Random Event Modal -->
            <div id="randomEventModal" class="modal hidden">
                <div class="modal-content event-modal-content">
                    <div class="event-icon" id="eventIcon">‚ö°</div>
                    <h3 class="event-title">Breaking News!</h3>
                    <p class="event-text" id="eventText"></p>
                    <div class="event-impact" id="eventImpact"></div>
                    <div class="event-countdown">
                        <div class="event-bar">
                            <div class="event-bar-fill" id="eventBarFill"></div>
                        </div>
                        <span>Adjusting your league...</span>
                    </div>
                </div>
            </div>

            <!-- Hold-to-Win indicator -->
            <div id="holdIndicator" class="hold-indicator hidden">
                <div class="hold-text">üîí Hold steady...</div>
                <div class="hold-bar-bg">
                    <div class="hold-bar-fill" id="holdBarFill"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/parityEngine.js"></script>
    <script src="js/gameLogic.js"></script>
    <script src="js/visualization.js"></script>
</body>
</html>
